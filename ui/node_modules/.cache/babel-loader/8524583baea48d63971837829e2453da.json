{"ast":null,"code":"import _classCallCheck from \"/root/Pokemon/ui/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/root/Pokemon/ui/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _possibleConstructorReturn from \"/root/Pokemon/ui/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js\";\nimport _assertThisInitialized from \"/root/Pokemon/ui/node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js\";\nimport _inherits from \"/root/Pokemon/ui/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _createSuper from \"/root/Pokemon/ui/node_modules/@babel/runtime/helpers/esm/createSuper.js\";\nimport { getWindow, getDocument } from 'ssr-window';\nimport $ from '../../shared/dom7.js';\nimport { extend, deleteProps } from '../../shared/utils.js';\nimport Framework7Class from '../../shared/class.js';\nimport { getDevice } from '../../shared/get-device.js';\nvar textEditorButtonsMap = {\n  // f7-icon, material-icon, command\n  bold: ['bold', 'format_bold', 'bold'],\n  italic: ['italic', 'format_italic', 'italic'],\n  underline: ['underline', 'format_underlined', 'underline'],\n  strikeThrough: ['strikethrough', 'strikethrough_s', 'strikeThrough'],\n  orderedList: ['list_number', 'format_list_numbered', 'insertOrderedList'],\n  unorderedList: ['list_bullet', 'format_list_bulleted', 'insertUnorderedList'],\n  link: ['link', 'link', 'createLink'],\n  image: ['photo', 'image', 'insertImage'],\n  paragraph: ['paragraph', '<i class=\"icon\">Â¶</i>', 'formatBlock.P'],\n  h1: ['<i class=\"icon\">H<sub>1</sub></i>', '<i class=\"icon\">H<sub>1</sub></i>', 'formatBlock.H1'],\n  h2: ['<i class=\"icon\">H<sub>2</sub></i>', '<i class=\"icon\">H<sub>2</sub></i>', 'formatBlock.H2'],\n  h3: ['<i class=\"icon\">H<sub>3</sub></i>', '<i class=\"icon\">H<sub>3</sub></i>', 'formatBlock.H3'],\n  alignLeft: ['text_alignleft', 'format_align_left', 'justifyLeft'],\n  alignCenter: ['text_aligncenter', 'format_align_center', 'justifyCenter'],\n  alignRight: ['text_alignright', 'format_align_right', 'justifyRight'],\n  alignJustify: ['text_justify', 'format_align_justify', 'justifyFull'],\n  subscript: ['textformat_subscript', '<i class=\"icon\">A<sub>1</sub></i>', 'subscript'],\n  superscript: ['textformat_superscript', '<i class=\"icon\">A<sup>1</sup></i>', 'superscript'],\n  indent: ['increase_indent', 'format_indent_increase', 'indent'],\n  outdent: ['decrease_indent', 'format_indent_decrease', 'outdent']\n};\n\nvar TextEditor = /*#__PURE__*/function (_Framework7Class) {\n  _inherits(TextEditor, _Framework7Class);\n\n  var _super = _createSuper(TextEditor);\n\n  function TextEditor(app, params) {\n    var _this;\n\n    _classCallCheck(this, TextEditor);\n\n    _this = _super.call(this, params, [app]);\n\n    var self = _assertThisInitialized(_this);\n\n    var document = getDocument();\n    var device = getDevice();\n    var defaults = extend({}, app.params.textEditor); // Extend defaults with modules params\n\n    self.useModulesParams(defaults);\n    self.params = extend(defaults, params);\n    var el = self.params.el;\n    if (!el) return _possibleConstructorReturn(_this, self);\n    var $el = $(el);\n    if ($el.length === 0) return _possibleConstructorReturn(_this, self);\n    if ($el[0].f7TextEditor) return _possibleConstructorReturn(_this, $el[0].f7TextEditor);\n    var $contentEl = $el.children('.text-editor-content');\n\n    if (!$contentEl.length) {\n      $el.append('<div class=\"text-editor-content\" contenteditable></div>');\n      $contentEl = $el.children('.text-editor-content');\n    }\n\n    extend(self, {\n      app: app,\n      $el: $el,\n      el: $el[0],\n      $contentEl: $contentEl,\n      contentEl: $contentEl[0]\n    });\n\n    if ('value' in params) {\n      self.value = self.params.value;\n    }\n\n    if (self.params.mode === 'keyboard-toolbar') {\n      if (!(device.cordova || device.capacitor) && !device.android) {\n        self.params.mode = 'popover';\n      }\n    }\n\n    if (typeof self.params.buttons === 'string') {\n      try {\n        self.params.buttons = JSON.parse(self.params.buttons);\n      } catch (err) {\n        throw new Error('Framework7: TextEditor: wrong \"buttons\" parameter format');\n      }\n    }\n\n    $el[0].f7TextEditor = self; // Bind\n\n    self.onButtonClick = self.onButtonClick.bind(self);\n    self.onFocus = self.onFocus.bind(self);\n    self.onBlur = self.onBlur.bind(self);\n    self.onInput = self.onInput.bind(self);\n    self.onPaste = self.onPaste.bind(self);\n    self.onSelectionChange = self.onSelectionChange.bind(self);\n    self.closeKeyboardToolbar = self.closeKeyboardToolbar.bind(self); // Handle Events\n\n    self.attachEvents = function attachEvents() {\n      if (self.params.mode === 'toolbar') {\n        self.$el.find('.text-editor-toolbar').on('click', 'button', self.onButtonClick);\n      }\n\n      if (self.params.mode === 'keyboard-toolbar') {\n        self.$keyboardToolbarEl.on('click', 'button', self.onButtonClick);\n        self.$el.parents('.page').on('page:beforeout', self.closeKeyboardToolbar);\n      }\n\n      if (self.params.mode === 'popover' && self.popover) {\n        self.popover.$el.on('click', 'button', self.onButtonClick);\n      }\n\n      self.$contentEl.on('paste', self.onPaste);\n      self.$contentEl.on('focus', self.onFocus);\n      self.$contentEl.on('blur', self.onBlur);\n      self.$contentEl.on('input', self.onInput, true);\n      $(document).on('selectionchange', self.onSelectionChange);\n    };\n\n    self.detachEvents = function detachEvents() {\n      if (self.params.mode === 'toolbar') {\n        self.$el.find('.text-editor-toolbar').off('click', 'button', self.onButtonClick);\n      }\n\n      if (self.params.mode === 'keyboard-toolbar') {\n        self.$keyboardToolbarEl.off('click', 'button', self.onButtonClick);\n        self.$el.parents('.page').off('page:beforeout', self.closeKeyboardToolbar);\n      }\n\n      if (self.params.mode === 'popover' && self.popover) {\n        self.popover.$el.off('click', 'button', self.onButtonClick);\n      }\n\n      self.$contentEl.off('paste', self.onPaste);\n      self.$contentEl.off('focus', self.onFocus);\n      self.$contentEl.off('blur', self.onBlur);\n      self.$contentEl.off('input', self.onInput, true);\n      $(document).off('selectionchange', self.onSelectionChange);\n    }; // Install Modules\n\n\n    self.useModules(); // Init\n\n    self.init();\n    return _possibleConstructorReturn(_this, self);\n  }\n\n  _createClass(TextEditor, [{\n    key: \"setValue\",\n    value: function setValue(newValue) {\n      var self = this;\n      var currentValue = self.value;\n      if (currentValue === newValue) return self;\n      self.value = newValue;\n      self.$contentEl.html(newValue);\n      self.$el.trigger('texteditor:change', self.value);\n      self.emit('local::change textEditorChange', self, self.value);\n      return self;\n    }\n  }, {\n    key: \"getValue\",\n    value: function getValue() {\n      var self = this;\n      return self.value;\n    }\n  }, {\n    key: \"clearValue\",\n    value: function clearValue() {\n      var self = this;\n      self.setValue('');\n\n      if (self.params.placeholder && !self.$contentEl.html()) {\n        self.insertPlaceholder();\n      }\n\n      return self;\n    }\n  }, {\n    key: \"createLink\",\n    value: function createLink() {\n      var self = this;\n      var window = getWindow();\n      var document = getDocument();\n      var currentSelection = window.getSelection();\n      var selectedNodes = [];\n      var $selectedLinks;\n\n      if (currentSelection && currentSelection.anchorNode && $(currentSelection.anchorNode).parents(self.$el).length) {\n        var anchorNode = currentSelection.anchorNode;\n\n        while (anchorNode) {\n          selectedNodes.push(anchorNode);\n\n          if (!anchorNode.nextSibling || anchorNode === currentSelection.focusNode) {\n            anchorNode = null;\n          }\n\n          if (anchorNode) {\n            anchorNode = anchorNode.nextSibling;\n          }\n        }\n\n        var selectedNodesLinks = [];\n        var $selectedNodes = $(selectedNodes);\n\n        for (var i = 0; i < $selectedNodes.length; i += 1) {\n          var childNodes = $selectedNodes[i].children;\n\n          if (childNodes) {\n            for (var j = 0; j < childNodes.length; j += 1) {\n              if ($(childNodes[j]).is('a')) {\n                selectedNodesLinks.push(childNodes[j]);\n              }\n            }\n          }\n        }\n\n        $selectedLinks = $selectedNodes.closest('a').add($(selectedNodesLinks));\n      }\n\n      if ($selectedLinks && $selectedLinks.length) {\n        $selectedLinks.each(function (linkNode) {\n          var selection = window.getSelection();\n          var range = document.createRange();\n          range.selectNodeContents(linkNode);\n          selection.removeAllRanges();\n          selection.addRange(range);\n          document.execCommand('unlink', false);\n          selection.removeAllRanges();\n        });\n        return self;\n      }\n\n      var currentRange = self.getSelectionRange();\n      if (!currentRange) return self;\n      var dialog = self.app.dialog.prompt(self.params.linkUrlText, '', function (link) {\n        if (link && link.trim().length) {\n          self.setSelectionRange(currentRange);\n          document.execCommand('createLink', false, link.trim());\n          self.$el.trigger('texteditor:insertlink', {\n            url: link.trim()\n          });\n          self.emit('local:insertLink textEditorInsertLink', self, link.trim());\n        }\n      });\n      dialog.$el.find('input').focus();\n      return self;\n    }\n  }, {\n    key: \"insertImage\",\n    value: function insertImage() {\n      var self = this;\n      var document = getDocument();\n      var currentRange = self.getSelectionRange();\n      if (!currentRange) return self;\n      var dialog = self.app.dialog.prompt(self.params.imageUrlText, '', function (imageUrl) {\n        if (imageUrl && imageUrl.trim().length) {\n          self.setSelectionRange(currentRange);\n          document.execCommand('insertImage', false, imageUrl.trim());\n          self.$el.trigger('texteditor:insertimage', {\n            url: imageUrl.trim()\n          });\n          self.emit('local:insertImage textEditorInsertImage', self, imageUrl.trim());\n        }\n      });\n      dialog.$el.find('input').focus();\n      return self;\n    }\n  }, {\n    key: \"removePlaceholder\",\n    value: function removePlaceholder() {\n      var self = this;\n      self.$contentEl.find('.text-editor-placeholder').remove();\n    }\n  }, {\n    key: \"insertPlaceholder\",\n    value: function insertPlaceholder() {\n      var self = this;\n      self.$contentEl.append(\"<div class=\\\"text-editor-placeholder\\\">\".concat(self.params.placeholder, \"</div>\"));\n    }\n  }, {\n    key: \"onSelectionChange\",\n    value: function onSelectionChange() {\n      var self = this;\n      var window = getWindow();\n      var document = getDocument();\n      if (self.params.mode === 'toolbar') return;\n      var selection = window.getSelection();\n      var selectionIsInContent = $(selection.anchorNode).parents(self.contentEl).length || selection.anchorNode === self.contentEl;\n\n      if (self.params.mode === 'keyboard-toolbar') {\n        if (!selectionIsInContent) {\n          self.closeKeyboardToolbar();\n        } else {\n          self.openKeyboardToolbar();\n        }\n\n        return;\n      }\n\n      if (self.params.mode === 'popover') {\n        var selectionIsInPopover = $(selection.anchorNode).parents(self.popover.el).length || selection.anchorNode === self.popover.el;\n\n        if (!selectionIsInContent && !selectionIsInPopover) {\n          self.closePopover();\n          return;\n        }\n\n        if (!selection.isCollapsed && selection.rangeCount) {\n          var range = selection.getRangeAt(0);\n          var rect = range.getBoundingClientRect();\n          var rootEl = self.app.$el[0] || document.body;\n          self.openPopover(rect.x + (window.scrollX || 0) - rootEl.offsetLeft, rect.y + (window.scrollY || 0) - rootEl.offsetTop, rect.width, rect.height);\n        } else if (selection.isCollapsed) {\n          self.closePopover();\n        }\n      }\n    }\n  }, {\n    key: \"onPaste\",\n    value: function onPaste(e) {\n      var self = this;\n      var document = getDocument();\n\n      if (self.params.clearFormattingOnPaste && e.clipboardData && e.clipboardData.getData) {\n        var text = e.clipboardData.getData('text/plain');\n        e.preventDefault();\n        document.execCommand('insertText', false, text);\n      }\n    }\n  }, {\n    key: \"onInput\",\n    value: function onInput() {\n      var self = this;\n      var value = self.$contentEl.html();\n      self.value = value;\n      self.$el.trigger('texteditor:input');\n      self.emit('local:input textEditorInput', self, self.value);\n      self.$el.trigger('texteditor:change', self.value);\n      self.emit('local::change textEditorChange', self, self.value);\n    }\n  }, {\n    key: \"onFocus\",\n    value: function onFocus() {\n      var self = this;\n      self.removePlaceholder();\n      self.$contentEl.focus();\n      self.$el.trigger('texteditor:focus');\n      self.emit('local::focus textEditorFocus', self);\n    }\n  }, {\n    key: \"onBlur\",\n    value: function onBlur() {\n      var self = this;\n      var window = getWindow();\n      var document = getDocument();\n\n      if (self.params.placeholder && self.$contentEl.html() === '') {\n        self.insertPlaceholder();\n      }\n\n      if (self.params.mode === 'popover') {\n        var selection = window.getSelection();\n        var selectionIsInContent = $(selection.anchorNode).parents(self.contentEl).length || selection.anchorNode === self.contentEl;\n        var inPopover = document.activeElement && self.popover && $(document.activeElement).closest(self.popover.$el).length;\n\n        if (!inPopover && !selectionIsInContent) {\n          self.closePopover();\n        }\n      }\n\n      if (self.params.mode === 'keyboard-toolbar') {\n        var _selection = window.getSelection();\n\n        var _selectionIsInContent = $(_selection.anchorNode).parents(self.contentEl).length || _selection.anchorNode === self.contentEl;\n\n        if (!_selectionIsInContent) {\n          self.closeKeyboardToolbar();\n        }\n      }\n\n      self.$el.trigger('texteditor:blur');\n      self.emit('local::blur textEditorBlur', self);\n    }\n  }, {\n    key: \"onButtonClick\",\n    value: function onButtonClick(e) {\n      var self = this;\n      var window = getWindow();\n      var document = getDocument();\n      var selection = window.getSelection();\n      var selectionIsInContent = $(selection.anchorNode).parents(self.contentEl).length || selection.anchorNode === self.contentEl;\n      if (!selectionIsInContent) return;\n      var $buttonEl = $(e.target).closest('button');\n\n      if ($buttonEl.parents('form').length) {\n        e.preventDefault();\n      }\n\n      var button = $buttonEl.attr('data-button');\n      var buttonData = self.params.customButtons && self.params.customButtons[button];\n      if (!button || !(textEditorButtonsMap[button] || buttonData)) return;\n      $buttonEl.trigger('texteditor:buttonclick', button);\n      self.emit('local::buttonClick textEditorButtonClick', self, button);\n\n      if (buttonData) {\n        if (buttonData.onClick) buttonData.onClick(self, $buttonEl[0]);\n        return;\n      }\n\n      var command = textEditorButtonsMap[button][2];\n\n      if (command === 'createLink') {\n        self.createLink();\n        return;\n      }\n\n      if (command === 'insertImage') {\n        self.insertImage();\n        return;\n      }\n\n      if (command.indexOf('formatBlock') === 0) {\n        var tagName = command.split('.')[1];\n        var $anchorNode = $(selection.anchorNode);\n\n        if ($anchorNode.parents(tagName.toLowerCase()).length || $anchorNode.is(tagName)) {\n          document.execCommand('formatBlock', false, 'div');\n        } else {\n          document.execCommand('formatBlock', false, tagName);\n        }\n\n        return;\n      }\n\n      document.execCommand(command, false);\n    } // eslint-disable-next-line\n\n  }, {\n    key: \"getSelectionRange\",\n    value: function getSelectionRange() {\n      var window = getWindow();\n      var document = getDocument();\n\n      if (window.getSelection) {\n        var sel = window.getSelection();\n\n        if (sel.getRangeAt && sel.rangeCount) {\n          return sel.getRangeAt(0);\n        }\n      } else if (document.selection && document.selection.createRange) {\n        return document.selection.createRange();\n      }\n\n      return null;\n    } // eslint-disable-next-line\n\n  }, {\n    key: \"setSelectionRange\",\n    value: function setSelectionRange(range) {\n      var window = getWindow();\n      var document = getDocument();\n\n      if (range) {\n        if (window.getSelection) {\n          var sel = window.getSelection();\n          sel.removeAllRanges();\n          sel.addRange(range);\n        } else if (document.selection && range.select) {\n          range.select();\n        }\n      }\n    }\n  }, {\n    key: \"renderButtons\",\n    value: function renderButtons() {\n      var self = this;\n      var html = '';\n\n      function renderButton(button) {\n        var iconClass = self.app.theme === 'md' ? 'material-icons' : 'f7-icons';\n\n        if (self.params.customButtons && self.params.customButtons[button]) {\n          var buttonData = self.params.customButtons[button];\n          return \"<button type=\\\"button\\\" class=\\\"text-editor-button\\\" data-button=\\\"\".concat(button, \"\\\">\").concat(buttonData.content || '', \"</button>\");\n        }\n\n        if (!textEditorButtonsMap[button]) return '';\n        var iconContent = textEditorButtonsMap[button][self.app.theme === 'md' ? 1 : 0];\n        return \"<button type=\\\"button\\\" class=\\\"text-editor-button\\\" data-button=\\\"\".concat(button, \"\\\">\").concat(iconContent.indexOf('<') >= 0 ? iconContent : \"<i class=\\\"\".concat(iconClass, \"\\\">\").concat(iconContent, \"</i>\"), \"</button>\").trim();\n      }\n\n      self.params.buttons.forEach(function (button, buttonIndex) {\n        if (Array.isArray(button)) {\n          button.forEach(function (b) {\n            html += renderButton(b);\n          });\n\n          if (buttonIndex < self.params.buttons.length - 1 && self.params.dividers) {\n            html += '<div class=\"text-editor-button-divider\"></div>';\n          }\n        } else {\n          html += renderButton(button);\n        }\n      });\n      return html;\n    }\n  }, {\n    key: \"createToolbar\",\n    value: function createToolbar() {\n      var self = this;\n      self.$el.prepend(\"<div class=\\\"text-editor-toolbar\\\">\".concat(self.renderButtons(), \"</div>\"));\n    }\n  }, {\n    key: \"createKeyboardToolbar\",\n    value: function createKeyboardToolbar() {\n      var self = this;\n      self.$keyboardToolbarEl = $(\"<div class=\\\"toolbar toolbar-bottom text-editor-keyboard-toolbar\\\"><div class=\\\"toolbar-inner\\\">\".concat(self.renderButtons(), \"</div></div>\"));\n    }\n  }, {\n    key: \"createPopover\",\n    value: function createPopover() {\n      var self = this;\n      self.popover = self.app.popover.create({\n        content: \"\\n        <div class=\\\"popover dark text-editor-popover\\\">\\n          <div class=\\\"popover-inner\\\">\".concat(self.renderButtons(), \"</div>\\n        </div>\\n      \"),\n        closeByOutsideClick: false,\n        backdrop: false\n      });\n    }\n  }, {\n    key: \"openKeyboardToolbar\",\n    value: function openKeyboardToolbar() {\n      var self = this;\n      if (self.$keyboardToolbarEl.parent(self.app.$el).length) return;\n      self.$el.trigger('texteditor:keyboardopen');\n      self.emit('local::keyboardOpen textEditorKeyboardOpen', self);\n      self.app.$el.append(self.$keyboardToolbarEl);\n    }\n  }, {\n    key: \"closeKeyboardToolbar\",\n    value: function closeKeyboardToolbar() {\n      var self = this;\n      self.$keyboardToolbarEl.remove();\n      self.$el.trigger('texteditor:keyboardclose');\n      self.emit('local::keyboardClose textEditorKeyboardClose', self);\n    }\n  }, {\n    key: \"openPopover\",\n    value: function openPopover(targetX, targetY, targetWidth, targetHeight) {\n      var self = this;\n      if (!self.popover) return;\n      Object.assign(self.popover.params, {\n        targetX: targetX,\n        targetY: targetY,\n        targetWidth: targetWidth,\n        targetHeight: targetHeight\n      });\n      clearTimeout(self.popoverTimeout);\n      self.popoverTimeout = setTimeout(function () {\n        if (!self.popover) return;\n\n        if (self.popover.opened) {\n          self.popover.resize();\n        } else {\n          self.$el.trigger('texteditor:popoveropen');\n          self.emit('local::popoverOpen textEditorPopoverOpen', self);\n          self.popover.open();\n        }\n      }, 400);\n    }\n  }, {\n    key: \"closePopover\",\n    value: function closePopover() {\n      var self = this;\n      clearTimeout(self.popoverTimeout);\n      if (!self.popover || !self.popover.opened) return;\n      self.popoverTimeout = setTimeout(function () {\n        if (!self.popover) return;\n        self.$el.trigger('texteditor:popoverclose');\n        self.emit('local::popoverClose textEditorPopoverClose', self);\n        self.popover.close();\n      }, 400);\n    }\n  }, {\n    key: \"init\",\n    value: function init() {\n      var self = this;\n\n      if (self.value) {\n        self.$contentEl.html(self.value);\n      } else {\n        self.value = self.$contentEl.html();\n      }\n\n      if (self.params.placeholder && self.value === '') {\n        self.insertPlaceholder();\n      }\n\n      if (self.params.mode === 'toolbar') {\n        self.createToolbar();\n      } else if (self.params.mode === 'popover') {\n        self.createPopover();\n      } else if (self.params.mode === 'keyboard-toolbar') {\n        self.createKeyboardToolbar();\n      }\n\n      self.attachEvents();\n      self.$el.trigger('texteditor:init');\n      self.emit('local::init textEditorInit', self);\n      return self;\n    }\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      var self = this;\n      self.$el.trigger('texteditor:beforedestroy');\n      self.emit('local::beforeDestroy textEditorBeforeDestroy', self);\n      self.detachEvents();\n\n      if (self.params.mode === 'keyboard-toolbar' && self.$keyboardToolbarEl) {\n        self.$keyboardToolbarEl.remove();\n      }\n\n      if (self.popover) {\n        self.popover.close(false);\n        self.popover.destroy();\n      }\n\n      delete self.$el[0].f7TextEditor;\n      deleteProps(self);\n      self = null;\n    }\n  }]);\n\n  return TextEditor;\n}(Framework7Class);\n\nexport default TextEditor;","map":{"version":3,"names":["getWindow","getDocument","$","extend","deleteProps","Framework7Class","getDevice","textEditorButtonsMap","bold","italic","underline","strikeThrough","orderedList","unorderedList","link","image","paragraph","h1","h2","h3","alignLeft","alignCenter","alignRight","alignJustify","subscript","superscript","indent","outdent","TextEditor","app","params","self","document","device","defaults","textEditor","useModulesParams","el","$el","length","f7TextEditor","$contentEl","children","append","contentEl","value","mode","cordova","capacitor","android","buttons","JSON","parse","err","Error","onButtonClick","bind","onFocus","onBlur","onInput","onPaste","onSelectionChange","closeKeyboardToolbar","attachEvents","find","on","$keyboardToolbarEl","parents","popover","detachEvents","off","useModules","init","newValue","currentValue","html","trigger","emit","setValue","placeholder","insertPlaceholder","window","currentSelection","getSelection","selectedNodes","$selectedLinks","anchorNode","push","nextSibling","focusNode","selectedNodesLinks","$selectedNodes","i","childNodes","j","is","closest","add","each","linkNode","selection","range","createRange","selectNodeContents","removeAllRanges","addRange","execCommand","currentRange","getSelectionRange","dialog","prompt","linkUrlText","trim","setSelectionRange","url","focus","imageUrlText","imageUrl","remove","selectionIsInContent","openKeyboardToolbar","selectionIsInPopover","closePopover","isCollapsed","rangeCount","getRangeAt","rect","getBoundingClientRect","rootEl","body","openPopover","x","scrollX","offsetLeft","y","scrollY","offsetTop","width","height","e","clearFormattingOnPaste","clipboardData","getData","text","preventDefault","removePlaceholder","inPopover","activeElement","$buttonEl","target","button","attr","buttonData","customButtons","onClick","command","createLink","insertImage","indexOf","tagName","split","$anchorNode","toLowerCase","sel","select","renderButton","iconClass","theme","content","iconContent","forEach","buttonIndex","Array","isArray","b","dividers","prepend","renderButtons","create","closeByOutsideClick","backdrop","parent","targetX","targetY","targetWidth","targetHeight","Object","assign","clearTimeout","popoverTimeout","setTimeout","opened","resize","open","close","createToolbar","createPopover","createKeyboardToolbar","destroy"],"sources":["/root/Pokemon/ui/node_modules/framework7/components/text-editor/text-editor-class.js"],"sourcesContent":["import { getWindow, getDocument } from 'ssr-window';\nimport $ from '../../shared/dom7.js';\nimport { extend, deleteProps } from '../../shared/utils.js';\nimport Framework7Class from '../../shared/class.js';\nimport { getDevice } from '../../shared/get-device.js';\nconst textEditorButtonsMap = {\n  // f7-icon, material-icon, command\n  bold: ['bold', 'format_bold', 'bold'],\n  italic: ['italic', 'format_italic', 'italic'],\n  underline: ['underline', 'format_underlined', 'underline'],\n  strikeThrough: ['strikethrough', 'strikethrough_s', 'strikeThrough'],\n  orderedList: ['list_number', 'format_list_numbered', 'insertOrderedList'],\n  unorderedList: ['list_bullet', 'format_list_bulleted', 'insertUnorderedList'],\n  link: ['link', 'link', 'createLink'],\n  image: ['photo', 'image', 'insertImage'],\n  paragraph: ['paragraph', '<i class=\"icon\">Â¶</i>', 'formatBlock.P'],\n  h1: ['<i class=\"icon\">H<sub>1</sub></i>', '<i class=\"icon\">H<sub>1</sub></i>', 'formatBlock.H1'],\n  h2: ['<i class=\"icon\">H<sub>2</sub></i>', '<i class=\"icon\">H<sub>2</sub></i>', 'formatBlock.H2'],\n  h3: ['<i class=\"icon\">H<sub>3</sub></i>', '<i class=\"icon\">H<sub>3</sub></i>', 'formatBlock.H3'],\n  alignLeft: ['text_alignleft', 'format_align_left', 'justifyLeft'],\n  alignCenter: ['text_aligncenter', 'format_align_center', 'justifyCenter'],\n  alignRight: ['text_alignright', 'format_align_right', 'justifyRight'],\n  alignJustify: ['text_justify', 'format_align_justify', 'justifyFull'],\n  subscript: ['textformat_subscript', '<i class=\"icon\">A<sub>1</sub></i>', 'subscript'],\n  superscript: ['textformat_superscript', '<i class=\"icon\">A<sup>1</sup></i>', 'superscript'],\n  indent: ['increase_indent', 'format_indent_increase', 'indent'],\n  outdent: ['decrease_indent', 'format_indent_decrease', 'outdent']\n};\n\nclass TextEditor extends Framework7Class {\n  constructor(app, params) {\n    super(params, [app]);\n    const self = this;\n    const document = getDocument();\n    const device = getDevice();\n    const defaults = extend({}, app.params.textEditor); // Extend defaults with modules params\n\n    self.useModulesParams(defaults);\n    self.params = extend(defaults, params);\n    const el = self.params.el;\n    if (!el) return self;\n    const $el = $(el);\n    if ($el.length === 0) return self;\n    if ($el[0].f7TextEditor) return $el[0].f7TextEditor;\n    let $contentEl = $el.children('.text-editor-content');\n\n    if (!$contentEl.length) {\n      $el.append('<div class=\"text-editor-content\" contenteditable></div>');\n      $contentEl = $el.children('.text-editor-content');\n    }\n\n    extend(self, {\n      app,\n      $el,\n      el: $el[0],\n      $contentEl,\n      contentEl: $contentEl[0]\n    });\n\n    if ('value' in params) {\n      self.value = self.params.value;\n    }\n\n    if (self.params.mode === 'keyboard-toolbar') {\n      if (!(device.cordova || device.capacitor) && !device.android) {\n        self.params.mode = 'popover';\n      }\n    }\n\n    if (typeof self.params.buttons === 'string') {\n      try {\n        self.params.buttons = JSON.parse(self.params.buttons);\n      } catch (err) {\n        throw new Error('Framework7: TextEditor: wrong \"buttons\" parameter format');\n      }\n    }\n\n    $el[0].f7TextEditor = self; // Bind\n\n    self.onButtonClick = self.onButtonClick.bind(self);\n    self.onFocus = self.onFocus.bind(self);\n    self.onBlur = self.onBlur.bind(self);\n    self.onInput = self.onInput.bind(self);\n    self.onPaste = self.onPaste.bind(self);\n    self.onSelectionChange = self.onSelectionChange.bind(self);\n    self.closeKeyboardToolbar = self.closeKeyboardToolbar.bind(self); // Handle Events\n\n    self.attachEvents = function attachEvents() {\n      if (self.params.mode === 'toolbar') {\n        self.$el.find('.text-editor-toolbar').on('click', 'button', self.onButtonClick);\n      }\n\n      if (self.params.mode === 'keyboard-toolbar') {\n        self.$keyboardToolbarEl.on('click', 'button', self.onButtonClick);\n        self.$el.parents('.page').on('page:beforeout', self.closeKeyboardToolbar);\n      }\n\n      if (self.params.mode === 'popover' && self.popover) {\n        self.popover.$el.on('click', 'button', self.onButtonClick);\n      }\n\n      self.$contentEl.on('paste', self.onPaste);\n      self.$contentEl.on('focus', self.onFocus);\n      self.$contentEl.on('blur', self.onBlur);\n      self.$contentEl.on('input', self.onInput, true);\n      $(document).on('selectionchange', self.onSelectionChange);\n    };\n\n    self.detachEvents = function detachEvents() {\n      if (self.params.mode === 'toolbar') {\n        self.$el.find('.text-editor-toolbar').off('click', 'button', self.onButtonClick);\n      }\n\n      if (self.params.mode === 'keyboard-toolbar') {\n        self.$keyboardToolbarEl.off('click', 'button', self.onButtonClick);\n        self.$el.parents('.page').off('page:beforeout', self.closeKeyboardToolbar);\n      }\n\n      if (self.params.mode === 'popover' && self.popover) {\n        self.popover.$el.off('click', 'button', self.onButtonClick);\n      }\n\n      self.$contentEl.off('paste', self.onPaste);\n      self.$contentEl.off('focus', self.onFocus);\n      self.$contentEl.off('blur', self.onBlur);\n      self.$contentEl.off('input', self.onInput, true);\n      $(document).off('selectionchange', self.onSelectionChange);\n    }; // Install Modules\n\n\n    self.useModules(); // Init\n\n    self.init();\n    return self;\n  }\n\n  setValue(newValue) {\n    const self = this;\n    const currentValue = self.value;\n    if (currentValue === newValue) return self;\n    self.value = newValue;\n    self.$contentEl.html(newValue);\n    self.$el.trigger('texteditor:change', self.value);\n    self.emit('local::change textEditorChange', self, self.value);\n    return self;\n  }\n\n  getValue() {\n    const self = this;\n    return self.value;\n  }\n\n  clearValue() {\n    const self = this;\n    self.setValue('');\n\n    if (self.params.placeholder && !self.$contentEl.html()) {\n      self.insertPlaceholder();\n    }\n\n    return self;\n  }\n\n  createLink() {\n    const self = this;\n    const window = getWindow();\n    const document = getDocument();\n    const currentSelection = window.getSelection();\n    const selectedNodes = [];\n    let $selectedLinks;\n\n    if (currentSelection && currentSelection.anchorNode && $(currentSelection.anchorNode).parents(self.$el).length) {\n      let anchorNode = currentSelection.anchorNode;\n\n      while (anchorNode) {\n        selectedNodes.push(anchorNode);\n\n        if (!anchorNode.nextSibling || anchorNode === currentSelection.focusNode) {\n          anchorNode = null;\n        }\n\n        if (anchorNode) {\n          anchorNode = anchorNode.nextSibling;\n        }\n      }\n\n      const selectedNodesLinks = [];\n      const $selectedNodes = $(selectedNodes);\n\n      for (let i = 0; i < $selectedNodes.length; i += 1) {\n        const childNodes = $selectedNodes[i].children;\n\n        if (childNodes) {\n          for (let j = 0; j < childNodes.length; j += 1) {\n            if ($(childNodes[j]).is('a')) {\n              selectedNodesLinks.push(childNodes[j]);\n            }\n          }\n        }\n      }\n\n      $selectedLinks = $selectedNodes.closest('a').add($(selectedNodesLinks));\n    }\n\n    if ($selectedLinks && $selectedLinks.length) {\n      $selectedLinks.each(linkNode => {\n        const selection = window.getSelection();\n        const range = document.createRange();\n        range.selectNodeContents(linkNode);\n        selection.removeAllRanges();\n        selection.addRange(range);\n        document.execCommand('unlink', false);\n        selection.removeAllRanges();\n      });\n      return self;\n    }\n\n    const currentRange = self.getSelectionRange();\n    if (!currentRange) return self;\n    const dialog = self.app.dialog.prompt(self.params.linkUrlText, '', link => {\n      if (link && link.trim().length) {\n        self.setSelectionRange(currentRange);\n        document.execCommand('createLink', false, link.trim());\n        self.$el.trigger('texteditor:insertlink', {\n          url: link.trim()\n        });\n        self.emit('local:insertLink textEditorInsertLink', self, link.trim());\n      }\n    });\n    dialog.$el.find('input').focus();\n    return self;\n  }\n\n  insertImage() {\n    const self = this;\n    const document = getDocument();\n    const currentRange = self.getSelectionRange();\n    if (!currentRange) return self;\n    const dialog = self.app.dialog.prompt(self.params.imageUrlText, '', imageUrl => {\n      if (imageUrl && imageUrl.trim().length) {\n        self.setSelectionRange(currentRange);\n        document.execCommand('insertImage', false, imageUrl.trim());\n        self.$el.trigger('texteditor:insertimage', {\n          url: imageUrl.trim()\n        });\n        self.emit('local:insertImage textEditorInsertImage', self, imageUrl.trim());\n      }\n    });\n    dialog.$el.find('input').focus();\n    return self;\n  }\n\n  removePlaceholder() {\n    const self = this;\n    self.$contentEl.find('.text-editor-placeholder').remove();\n  }\n\n  insertPlaceholder() {\n    const self = this;\n    self.$contentEl.append(`<div class=\"text-editor-placeholder\">${self.params.placeholder}</div>`);\n  }\n\n  onSelectionChange() {\n    const self = this;\n    const window = getWindow();\n    const document = getDocument();\n    if (self.params.mode === 'toolbar') return;\n    const selection = window.getSelection();\n    const selectionIsInContent = $(selection.anchorNode).parents(self.contentEl).length || selection.anchorNode === self.contentEl;\n\n    if (self.params.mode === 'keyboard-toolbar') {\n      if (!selectionIsInContent) {\n        self.closeKeyboardToolbar();\n      } else {\n        self.openKeyboardToolbar();\n      }\n\n      return;\n    }\n\n    if (self.params.mode === 'popover') {\n      const selectionIsInPopover = $(selection.anchorNode).parents(self.popover.el).length || selection.anchorNode === self.popover.el;\n\n      if (!selectionIsInContent && !selectionIsInPopover) {\n        self.closePopover();\n        return;\n      }\n\n      if (!selection.isCollapsed && selection.rangeCount) {\n        const range = selection.getRangeAt(0);\n        const rect = range.getBoundingClientRect();\n        const rootEl = self.app.$el[0] || document.body;\n        self.openPopover(rect.x + (window.scrollX || 0) - rootEl.offsetLeft, rect.y + (window.scrollY || 0) - rootEl.offsetTop, rect.width, rect.height);\n      } else if (selection.isCollapsed) {\n        self.closePopover();\n      }\n    }\n  }\n\n  onPaste(e) {\n    const self = this;\n    const document = getDocument();\n\n    if (self.params.clearFormattingOnPaste && e.clipboardData && e.clipboardData.getData) {\n      const text = e.clipboardData.getData('text/plain');\n      e.preventDefault();\n      document.execCommand('insertText', false, text);\n    }\n  }\n\n  onInput() {\n    const self = this;\n    const value = self.$contentEl.html();\n    self.value = value;\n    self.$el.trigger('texteditor:input');\n    self.emit('local:input textEditorInput', self, self.value);\n    self.$el.trigger('texteditor:change', self.value);\n    self.emit('local::change textEditorChange', self, self.value);\n  }\n\n  onFocus() {\n    const self = this;\n    self.removePlaceholder();\n    self.$contentEl.focus();\n    self.$el.trigger('texteditor:focus');\n    self.emit('local::focus textEditorFocus', self);\n  }\n\n  onBlur() {\n    const self = this;\n    const window = getWindow();\n    const document = getDocument();\n\n    if (self.params.placeholder && self.$contentEl.html() === '') {\n      self.insertPlaceholder();\n    }\n\n    if (self.params.mode === 'popover') {\n      const selection = window.getSelection();\n      const selectionIsInContent = $(selection.anchorNode).parents(self.contentEl).length || selection.anchorNode === self.contentEl;\n      const inPopover = document.activeElement && self.popover && $(document.activeElement).closest(self.popover.$el).length;\n\n      if (!inPopover && !selectionIsInContent) {\n        self.closePopover();\n      }\n    }\n\n    if (self.params.mode === 'keyboard-toolbar') {\n      const selection = window.getSelection();\n      const selectionIsInContent = $(selection.anchorNode).parents(self.contentEl).length || selection.anchorNode === self.contentEl;\n\n      if (!selectionIsInContent) {\n        self.closeKeyboardToolbar();\n      }\n    }\n\n    self.$el.trigger('texteditor:blur');\n    self.emit('local::blur textEditorBlur', self);\n  }\n\n  onButtonClick(e) {\n    const self = this;\n    const window = getWindow();\n    const document = getDocument();\n    const selection = window.getSelection();\n    const selectionIsInContent = $(selection.anchorNode).parents(self.contentEl).length || selection.anchorNode === self.contentEl;\n    if (!selectionIsInContent) return;\n    const $buttonEl = $(e.target).closest('button');\n\n    if ($buttonEl.parents('form').length) {\n      e.preventDefault();\n    }\n\n    const button = $buttonEl.attr('data-button');\n    const buttonData = self.params.customButtons && self.params.customButtons[button];\n    if (!button || !(textEditorButtonsMap[button] || buttonData)) return;\n    $buttonEl.trigger('texteditor:buttonclick', button);\n    self.emit('local::buttonClick textEditorButtonClick', self, button);\n\n    if (buttonData) {\n      if (buttonData.onClick) buttonData.onClick(self, $buttonEl[0]);\n      return;\n    }\n\n    const command = textEditorButtonsMap[button][2];\n\n    if (command === 'createLink') {\n      self.createLink();\n      return;\n    }\n\n    if (command === 'insertImage') {\n      self.insertImage();\n      return;\n    }\n\n    if (command.indexOf('formatBlock') === 0) {\n      const tagName = command.split('.')[1];\n      const $anchorNode = $(selection.anchorNode);\n\n      if ($anchorNode.parents(tagName.toLowerCase()).length || $anchorNode.is(tagName)) {\n        document.execCommand('formatBlock', false, 'div');\n      } else {\n        document.execCommand('formatBlock', false, tagName);\n      }\n\n      return;\n    }\n\n    document.execCommand(command, false);\n  } // eslint-disable-next-line\n\n\n  getSelectionRange() {\n    const window = getWindow();\n    const document = getDocument();\n\n    if (window.getSelection) {\n      const sel = window.getSelection();\n\n      if (sel.getRangeAt && sel.rangeCount) {\n        return sel.getRangeAt(0);\n      }\n    } else if (document.selection && document.selection.createRange) {\n      return document.selection.createRange();\n    }\n\n    return null;\n  } // eslint-disable-next-line\n\n\n  setSelectionRange(range) {\n    const window = getWindow();\n    const document = getDocument();\n\n    if (range) {\n      if (window.getSelection) {\n        const sel = window.getSelection();\n        sel.removeAllRanges();\n        sel.addRange(range);\n      } else if (document.selection && range.select) {\n        range.select();\n      }\n    }\n  }\n\n  renderButtons() {\n    const self = this;\n    let html = '';\n\n    function renderButton(button) {\n      const iconClass = self.app.theme === 'md' ? 'material-icons' : 'f7-icons';\n\n      if (self.params.customButtons && self.params.customButtons[button]) {\n        const buttonData = self.params.customButtons[button];\n        return `<button type=\"button\" class=\"text-editor-button\" data-button=\"${button}\">${buttonData.content || ''}</button>`;\n      }\n\n      if (!textEditorButtonsMap[button]) return '';\n      const iconContent = textEditorButtonsMap[button][self.app.theme === 'md' ? 1 : 0];\n      return `<button type=\"button\" class=\"text-editor-button\" data-button=\"${button}\">${iconContent.indexOf('<') >= 0 ? iconContent : `<i class=\"${iconClass}\">${iconContent}</i>`}</button>`.trim();\n    }\n\n    self.params.buttons.forEach((button, buttonIndex) => {\n      if (Array.isArray(button)) {\n        button.forEach(b => {\n          html += renderButton(b);\n        });\n\n        if (buttonIndex < self.params.buttons.length - 1 && self.params.dividers) {\n          html += '<div class=\"text-editor-button-divider\"></div>';\n        }\n      } else {\n        html += renderButton(button);\n      }\n    });\n    return html;\n  }\n\n  createToolbar() {\n    const self = this;\n    self.$el.prepend(`<div class=\"text-editor-toolbar\">${self.renderButtons()}</div>`);\n  }\n\n  createKeyboardToolbar() {\n    const self = this;\n    self.$keyboardToolbarEl = $(`<div class=\"toolbar toolbar-bottom text-editor-keyboard-toolbar\"><div class=\"toolbar-inner\">${self.renderButtons()}</div></div>`);\n  }\n\n  createPopover() {\n    const self = this;\n    self.popover = self.app.popover.create({\n      content: `\n        <div class=\"popover dark text-editor-popover\">\n          <div class=\"popover-inner\">${self.renderButtons()}</div>\n        </div>\n      `,\n      closeByOutsideClick: false,\n      backdrop: false\n    });\n  }\n\n  openKeyboardToolbar() {\n    const self = this;\n    if (self.$keyboardToolbarEl.parent(self.app.$el).length) return;\n    self.$el.trigger('texteditor:keyboardopen');\n    self.emit('local::keyboardOpen textEditorKeyboardOpen', self);\n    self.app.$el.append(self.$keyboardToolbarEl);\n  }\n\n  closeKeyboardToolbar() {\n    const self = this;\n    self.$keyboardToolbarEl.remove();\n    self.$el.trigger('texteditor:keyboardclose');\n    self.emit('local::keyboardClose textEditorKeyboardClose', self);\n  }\n\n  openPopover(targetX, targetY, targetWidth, targetHeight) {\n    const self = this;\n    if (!self.popover) return;\n    Object.assign(self.popover.params, {\n      targetX,\n      targetY,\n      targetWidth,\n      targetHeight\n    });\n    clearTimeout(self.popoverTimeout);\n    self.popoverTimeout = setTimeout(() => {\n      if (!self.popover) return;\n\n      if (self.popover.opened) {\n        self.popover.resize();\n      } else {\n        self.$el.trigger('texteditor:popoveropen');\n        self.emit('local::popoverOpen textEditorPopoverOpen', self);\n        self.popover.open();\n      }\n    }, 400);\n  }\n\n  closePopover() {\n    const self = this;\n    clearTimeout(self.popoverTimeout);\n    if (!self.popover || !self.popover.opened) return;\n    self.popoverTimeout = setTimeout(() => {\n      if (!self.popover) return;\n      self.$el.trigger('texteditor:popoverclose');\n      self.emit('local::popoverClose textEditorPopoverClose', self);\n      self.popover.close();\n    }, 400);\n  }\n\n  init() {\n    const self = this;\n\n    if (self.value) {\n      self.$contentEl.html(self.value);\n    } else {\n      self.value = self.$contentEl.html();\n    }\n\n    if (self.params.placeholder && self.value === '') {\n      self.insertPlaceholder();\n    }\n\n    if (self.params.mode === 'toolbar') {\n      self.createToolbar();\n    } else if (self.params.mode === 'popover') {\n      self.createPopover();\n    } else if (self.params.mode === 'keyboard-toolbar') {\n      self.createKeyboardToolbar();\n    }\n\n    self.attachEvents();\n    self.$el.trigger('texteditor:init');\n    self.emit('local::init textEditorInit', self);\n    return self;\n  }\n\n  destroy() {\n    let self = this;\n    self.$el.trigger('texteditor:beforedestroy');\n    self.emit('local::beforeDestroy textEditorBeforeDestroy', self);\n    self.detachEvents();\n\n    if (self.params.mode === 'keyboard-toolbar' && self.$keyboardToolbarEl) {\n      self.$keyboardToolbarEl.remove();\n    }\n\n    if (self.popover) {\n      self.popover.close(false);\n      self.popover.destroy();\n    }\n\n    delete self.$el[0].f7TextEditor;\n    deleteProps(self);\n    self = null;\n  }\n\n}\n\nexport default TextEditor;"],"mappings":"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"},"metadata":{},"sourceType":"module"}